<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link th:href="@{/css/signin.css}" rel="stylesheet">
  <title>삐슐랭가이드</title>
</head>

<body class="text-center">

<form class="form-signin" name="login" th:action="@{/account/login}" method="post">
  <a th:href="@{/}">홈으로돌아가기</a>
  <h1 class="h3 mb-3 fw-normal">로그인 해주세요</h1>
  <div class="alert alert-danger" role="alert" th:if="${param.error}">
    Invalid username and password.
  </div>
  <div class="alert alert-primary" role="alert" th:if="${param.logout}">
    You have been logged out.
  </div>
  <div class="form-floating">
    <input type="text" id="username" name="username" class="form-control" placeholder="Username">
    <label for="username">Username</label>
  </div>
  <div class="form-floating">
    <input type="password" id="inputPassword" name="password" class="form-control" placeholder="Password">
    <label for="inputPassword">Password</label>
  </div>
  <button class="w-100 btn btn-lg btn-primary" id="submit">로그인</button>
  <!--<button class="w-100 btn btn-lg btn-primary" type="submit">로그인</button>-->
</form>

<footer th:replace="fragments/common :: footer"></footer>
<script>
  $('#submit').click(function(){   //submit 버튼을 클릭하였을 때
    alert("test")
    var datas = objToJson($("form[name=login]").serializeArray());
    $.ajax({
      type : 'POST',
      url : 'http://localhost:8080/account/login',
      data : JSON.stringify(datas),
      dataType : 'text',  //위와 같이 dataType:json 일 경우 json 형태로 맞춰서 데이터를 받지 못해 오류 발생
      contentType : "application/json",
      error: function(xhr, status, error){
        alert(error);
      },
      success : function(token){
        console.log(token);
        var expireDay = 24 * 60 * 60 * 1000; //1일
        document.cookie = "X-AUTH-TOKEN=" + token + expireDay +"; path=/";

      },
    });
  });
</script>

</body>
</html>